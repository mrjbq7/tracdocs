==============
   tracdocs
==============


Description
===========

The 'tracdocs' project is a plugin for the 'trac' project management tool.

Many documents exists adjacent to the code that is being developed and
managed. These documents are not conveniently stored in a wiki due to the lack
of offline access and editing. Also, a wiki tends to be less structured than
the documentation that lives with source code.

The 'tracdocs' plugin adds a "Docs" tab to the trac project. Underneath this
tab can be found all of the documentation that the current logged in user has
access to.

Note: this plugin respects the access rights of the user that is logged in.


Installation
============

The 'tracdocs' plugin can be installed using standard::

    python setup.py install


Configuration
=============

It is configured in the trac.ini file by enabling and configuring:

{{{
[components]
tracdocs.* = enabled

[docs]
root = wiki/trunk
}}}

We use the ``google-code-prettify`` to make the literal-blocks in the ReST 
documents "pretty print" source code.  To get this to work, you need to 
modify the ``header.cs`` in the trac templates directory of your trac 
installation.

Change::

    <body>

to::

    <body onload="prettyPrint()">


Using trac 0.11
===============

It looks like changes made to move templates away from Clearsilver have
introduced a regression where active navigation items are not highlighted
properly.

To reproduce, use a plugin that returns a Clearsilver template from its
process_request() method. You will see that the "mainnav" navigation bar does
not render the active item highlighted.

The bug is that the CSS class "active" is not assigned to the list element in
the navigation bar.

The fix is to change trac/web/chrome.py::

    class Chrome(component)
    ...
        def populate_hdf(self, req):
        ...
            for category, items in req.chrome['nav'].items():
    +           req.hdf['chrome.nav.%s' % category] = items
    -           for item in items:
    -               prefix = 'chrome.nav.%s.%s' % (category, item['name'])
    -               req.hdf[prefix] = item['label']

And then change trac/templates/header.cs::

    <?cs def:nav(items) ?><?cs
     if:len(items) ?><ul><?cs
      set:idx = 0 ?><?cs
      set:max = len(items) - 1 ?><?cs
      each:item = items ?><?cs
       set:first = idx == 0 ?><?cs
       set:last = idx == max ?><li<?cs
       if:first || last || item.active ?> class="<?cs
        if:item.active ?>active<?cs /if ?><?cs
        if:item.active && (first || last) ?> <?cs /if ?><?cs
        if:first ?>first<?cs /if ?><?cs
        if:(item.active || first) && last ?> <?cs /if ?><?cs
        if:last ?>last<?cs /if ?>"<?cs
    +  /if ?>><?cs var:item.label ?></li><?cs
    -  /if ?>><?cs var:item?></li><?cs
       set:idx = idx + 1 ?><?cs
      /each ?></ul><?cs
     /if ?><?cs
    /def ?>

This bug was filed as bug #7418 on trac.edgewall.org.

